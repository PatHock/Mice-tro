version '0.1'

buildscript {
    repositories {
        jcenter()
//        mavenCentral()
    }

    dependencies {
        classpath 'com.bmuschko:gradle-tomcat-plugin:2.4.2'
//        classpath 'org.junit.platform:junit-platform-gradle-plugin:1.0.1'
    }
}

repositories {
    mavenCentral()
}

apply plugin: 'java'
//apply plugin: 'org.junit.platform.gradle.plugin'
apply plugin: 'war'
apply plugin: 'com.bmuschko.tomcat'
apply plugin: "jacoco"
apply plugin: 'application'

sourceCompatibility = 1.9

mainClassName = "com.micetr0.Main"

dependencies {
    def tomcatVersion = '9.0.6'
    tomcat "org.apache.tomcat.embed:tomcat-embed-core:${tomcatVersion}",
            "org.apache.tomcat.embed:tomcat-embed-logging-juli:9.0.0.M6",
            "org.apache.tomcat.embed:tomcat-embed-jasper:${tomcatVersion}"

//    testCompile('org.junit.jupiter:junit-jupiter-api:5.1.0')
//    testRuntime('org.junit.jupiter:junit-jupiter-engine:5.1.0')

    testCompile group: 'junit', name: 'junit', version: '4.11'
    testCompile group: 'junit', name: 'junit', version: '4.12'
    providedCompile 'javax.servlet:javax.servlet-api:3.1.0'

}

tomcat {
    httpPort = 8082
    httpsPort = 8091
    httpProtocol = 'org.apache.coyote.http11.Http11Nio2Protocol'
    ajpProtocol  = 'org.apache.coyote.ajp.AjpNio2Protocol'
}

jacoco {
    toolVersion = "0.8.1"
    reportsDir = file("$buildDir/JacocoCodeCoverageReports")
}

jacocoTestReport {
    reports {
        xml.enabled true
        csv.enabled false
        html.destination file("${buildDir}/jacocoHtml")
    }
}

check.dependsOn jacocoTestReport

jacocoTestCoverageVerification {
    violationRules {
        rule {
            limit {
                minimum = 0.7
            }
        }
    }
}